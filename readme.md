# 网易云 to Bilibili 全自动同步工具 (终极版 / 附加模式)

这是一个功能强大的自动化Python脚本，旨在全自动地同步一个网易云音乐歌单到Bilibili收藏夹。经过多次迭代，它采用**“附加到现有浏览器”**的模式，能有效规避网易云音乐强大的反爬虫检测。同时，脚本集成了**风控自愈**、**断点续传**和**失败重试**等高级功能，特别适合处理大型歌单。

## ✨ 核心功能

- **反爬虫规避 (核心)**:
    - 采用**“附加模式”**，脚本会连接到一个由用户手动启动的、干净的Chrome浏览器实例，而不是自行启动一个带有自动化特征的浏览器。这是应对高强度反爬检测的终极方案。

- **强大的B站收藏引擎**:
    - **风控自愈**: 当检测到B站的风控错误(HTTP 412或连续搜索无果)时，脚本会自动保存进度，**暂停5分钟**，然后加载失败列表**继续尝试**，直至所有歌曲处理完毕。
    - **智能筛选**: 自动过滤B站搜索结果，优先选择时长在1-10分钟之间的视频。
    - **单一收藏夹**: 每次任务只创建一个以时间命名的收藏夹 (如 `09010156`)，无论中途重试多少次，所有歌曲都会被收藏到这同一个文件夹中，保持整洁。

- **高级容错与续传**:
    - **进度自动保存**: 在因风控中断后，脚本会将**当前任务及所有剩余未处理的歌曲**自动保存到 `fail.json`。
    - **失败重试**: 脚本启动时，会询问用户是想处理完整的URL歌单，还是仅处理上次失败的 `fail.json` 列表。
    - **断点续传 (按歌名)**: 用户可以选择从歌单中的**任意一首歌曲**开始执行任务。无需记住序号，只需输入歌曲名称的一部分即可自动定位。

- **配置化与用户友好**:
    - **配置缓存**: 网易云URL和B站Cookie均会保存到本地，并询问是否更新，操作便捷。
    - **清晰的指引**: 全程提供清晰的命令行提示，引导用户完成每一步操作。

## 🚨 重要提示 (必读)

1.  **必须使用歌单所有者的账号登录**
    * 为了获取完整的歌单列表，你必须在手动打开的Chrome浏览器中，登录**创建该歌单的那个网易云账号**。
    * 如果使用其他账号登录，网易云的网页只会显示该歌单的前20首歌曲。

2.  **歌单歌曲数量上限为1000首**
    * 由于网易云音乐网页版的限制，即使是歌单所有者，**最多也只能看到歌单里的前1000首歌曲**。
    * 如果你的歌单超过1000首歌，脚本也只能获取到前1000首。

## 🚀 运行流程

这是一个两步过程：首先需要你手动启动一个“特殊”的Chrome，然后才能运行Python脚本。

### 第一步: 环境准备与依赖安装

- **Python 3**: 确保已安装 Python 3.7 或更高版本。
- **Google Chrome**: 电脑上需要安装Chrome浏览器。
- **创建文件**: 在项目文件夹中，创建 `run.py` 和 `requirements.txt` 两个文件。
- **填入依赖**: 在 `requirements.txt` 文件中，填入以下内容：
    ```
    bilibili-api-python
    undetected-chromedriver
    selenium
    ```
- **安装依赖**: 打开终端，进入项目目录，运行：
    ```bash
    pip install -r requirements.txt
    ```

### 第二步: 手动启动调试模式的Chrome

**在运行Python脚本之前**，请严格执行以下操作：

1.  **彻底关闭你电脑上所有的Chrome浏览器窗口和后台进程** (建议使用任务管理器或Activity Monitor确认)。
2.  根据你的操作系统，在终端中执行对应的命令来启动一个带调试端口的Chrome：

    * **Windows (在CMD或PowerShell中运行):**
      ```cmd
      "C:\Program Files\Google\Chrome\Application\chrome.exe" --remote-debugging-port=9527 --user-data-dir="C:\Users\%USERNAME%\Chrome_dev_session"
      ```
      *(如果你的Chrome安装路径不同, 请相应修改)*

    * **macOS (在Terminal中运行):**
      ```bash
      /Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --remote-debugging-port=9527 --user-data-dir="$HOME/Chrome_dev_session"
      ```
3.  执行命令后，会弹出一个全新的Chrome窗口。**在这个窗口中，手动访问 `music.163.com` 并完成登录**。
4.  登录成功后，**保持这个浏览器窗口和对应的终端窗口都不要关闭**。

### 第三步: 运行Python脚本

现在，打开**另一个**新的终端窗口，进入你的项目目录，运行主程序：
```bash
python run.py
```
脚本会提示你确认，然后自动连接到你刚刚手动打开的浏览器，并接管后续所有操作。

## 🔧 疑难解答：连接失败怎么办？

如果你运行 `run.py` 后，脚本依然弹出了一个**新**的浏览器窗口，而不是连接到你手动打开的那个，说明连接失败了。请按以下步骤排查：

#### 1. 检查端口是否被占用

在你启动Chrome之前，可以用这个命令检查 `9527` 端口是否已被其他程序占用。

* **Windows:**
    ```cmd
    netstat -ano | findstr ":9527"
    ```
    (如果**没有任何输出**，说明端口可用。)

* **macOS:**
    ```bash
    lsof -i :9527
    ```
    (如果**没有任何输出**，说明端口可用。)

#### 2. 确认调试服务是否启动

在你手动用命令启动Chrome之后，可以通过一个简单的测试来100%确认它的调试服务是否正常工作。

1.  打开一个**普通的、其他的**浏览器窗口 (用你日常的浏览器即可)。
2.  访问地址：`http://127.0.0.1:9527/json/version`
3.  **如果成功**，你会看到一个包含版本信息的JSON文本页面。这证明服务已就绪。
4.  **如果失败**，页面会显示“无法访问此网站”，说明调试服务没有成功启动，请检查你第一步的命令是否正确，以及是否彻底关闭了所有其他Chrome进程。

**只有在确认调试服务成功启动后**，你的Python脚本才能成功连接。

## 📁 项目文件结构

```
.
├── run.py                   # 自动化主程序
├── requirements.txt         # Python 依赖列表
├── playlist.json            # (自动生成) 缓存的完整网易云歌单
├── fail.json                # (自动生成) 上次失败或未完成的歌曲列表
├── playlist_config.json     # (自动生成) 缓存的网易云URL
└── bili_cookie.json         # (自动生成) 缓存的B站Cookie
```